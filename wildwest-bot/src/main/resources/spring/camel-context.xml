<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd        http://camel.apache.org/schema/spring       http://camel.apache.org/schema/spring/camel-spring.xsd">
    <camelContext id="camel" xmlns="http://camel.apache.org/schema/spring">
        <dataFormats>
            <json id="transform-game" library="Jackson" unmarshalTypeName="com.openshift.wildwest.models.Game"/>
            <json id="transform-platform-object" library="Jackson" unmarshalTypeName="com.openshift.wildwest.models.PlatformObject"/>
        </dataFormats>
        <route id="simple-route">
            <from id="route-timer" uri="timer://foo?period=10000"/>
            <filter>
       			<simple>${header.gameID} == null</simple>
       			<log id="init-game-log" message="Starting new game"/>
       			<toD uri="http4:{{backend.service}}/createGame"/>
       			<unmarshal ref="transform-game"/>
       			<setHeader headerName="gameID"><simple>${body.score.gameID}</simple></setHeader>
       			<log message="New game started ${header.gameID}"/>
       			<removeHeaders pattern="CamelHttp*"/>
   			</filter>
            <log id="route-log" message="getRandomObject ${property.TIMER_COUNTER}"/>
            <toD uri="http4:{{backend.service}}/getRandomObject"/>
            <unmarshal ref="transform-platform-object"/>
       		<setHeader headerName="objectType"><simple>${body.objectType}</simple></setHeader>
       		<setHeader headerName="objectID"><simple>${body.objectID}</simple></setHeader>
       		<setHeader headerName="objectName"><simple>${body.objectName}</simple></setHeader>
       		<removeHeaders pattern="CamelHttp*"/>
       		<log message="deleteObject ${body.objectName}"/>
       		<toD uri="http4:{{backend.service}}/ws/deleteObject?gameID=${header.gameID}&amp;objectType=${body.objectType}&amp;objectName=${body.objectName}&amp;objectID=${body.objectID}"/>
            <log message="done"/> 
        </route>
    </camelContext>
</beans>
